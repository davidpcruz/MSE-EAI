<?xml version="1.0"?>
<jbossesb parameterReloadSecs="5"
	xmlns="http://anonsvn.labs.jboss.com/labs/jbossesb/trunk/product/etc/schemas/xml/jbossesb-1.3.0.xsd"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://anonsvn.labs.jboss.com/labs/jbossesb/trunk/product/etc/schemas/xml/jbossesb-1.3.0.xsd http://anonsvn.jboss.org/repos/labs/labs/jbossesb/trunk/product/etc/schemas/xml/jbossesb-1.3.0.xsd">
	<providers>
		<jms-provider connection-factory="ConnectionFactory"
			name="JMS">
			<jms-bus busid="startGwChannel">
				<jms-message-filter dest-name="queue/bpm_start_request_gw"
					dest-type="QUEUE" />
			</jms-bus>
			<jms-bus busid="startEsbChannel">
				<jms-message-filter dest-name="queue/bpm_start_request_esb"
					dest-type="QUEUE" />
			</jms-bus>


			<!-- TODO: Remove. This is temporary for debug -->
			<jms-bus busid="mailDispatchGwChannel">
				<jms-message-filter dest-name="queue/bpm_mail_dispatch_request_gw"
					dest-type="QUEUE" />
			</jms-bus>

			<!-- TODO: Remove. This is temporary for debug -->
			<jms-bus busid="mailDispatchEsbChannel">
				<jms-message-filter dest-name="queue/bpm_mail_dispatch_request_esb"
					dest-type="QUEUE" />
			</jms-bus>

			<!-- TODO: Remove. This is temporary for debug -->
			<jms-bus busid="mailCountGwChannel">
				<jms-message-filter dest-name="queue/bpm_mail_count_request_gw"
					dest-type="QUEUE" />
			</jms-bus>

			<!-- TODO: Remove. This is temporary for debug -->
			<jms-bus busid="mailCountEsbChannel">
				<jms-message-filter dest-name="queue/bpm_mail_count_request_esb"
					dest-type="QUEUE" />
			</jms-bus>

			<!-- TODO: Remove. This is temporary for debug -->
			<jms-bus busid="testGwChannel">
				<jms-message-filter dest-name="queue/bpm_test_request_gw"
					dest-type="QUEUE" />
			</jms-bus>

			<!-- TODO: Remove. This is temporary for debug -->
			<jms-bus busid="testEsbChannel">
				<jms-message-filter dest-name="queue/bpm_test_request_esb"
					dest-type="QUEUE" />
			</jms-bus>
		</jms-provider>
	</providers>
	<services>

		<!-- ESB Orchestration service to wrap BPM process invocation -->
		<service category="jBPM Orchestrator Service"
			description="BPM Orchestration Service: Process instance starter"
			name="Start">

			<listeners>
				<jms-listener busidref="startGwChannel" is-gateway="true"
					name="JMS-Gateway" />
				<jms-listener busidref="startEsbChannel" name="ESB-Listener" />
			</listeners>

			<actions mep="OneWay">

				<action name="entryPrint" class="org.jboss.soa.esb.actions.SystemPrintln">
					<property name="message" value="Starting jBPM Orchestration Process..."></property>
				</action>

				<action class="org.jboss.soa.esb.services.jbpm.actions.BpmProcessor"
					name="BpmProcessor">
					<property name="command" value="StartProcessInstanceCommand" />
					<property name="process-definition-name" value="eai.msejdf.jbpm" />
					<property name="esbToBpmVars">
						<mapping bpm="msgBody" esb="BODY_CONTENT" />
					</property>
				</action>

				<action name="exitPrint" class="org.jboss.soa.esb.actions.SystemPrintln">
					<property name="message"
						value="Starting jBPM Orchestration Process...Complete"></property>
				</action>

			</actions>
		</service>

		<!-- e-mail dispatch service -->
		<service category="EAI.MSEJDF.Service"
			description="e-mail dispatch service"
			name="Send e-mail">

			<listeners>
				<jms-listener busidref="mailDispatchGwChannel" is-gateway="true"
					name="JMS-Gateway" />
				<jms-listener busidref="mailDispatchEsbChannel" name="ESB-Listener" />
			</listeners>

			<actions mep="OneWay">

				<action name="entryPrint" class="org.jboss.soa.esb.actions.SystemPrintln">
					<property name="message" value="Start e-mail sending..."></property>
				</action>

				<action name="send-email" class="eai.msejdf.esb.SendMail">
				</action>

				<action name="exitPrint" class="org.jboss.soa.esb.actions.SystemPrintln">
					<property name="message"
						value="Starte-mail sending...Complete"></property>
				</action>

			</actions>
		</service>

		<!-- TODO: Remove. This is temporary for debug -->
		<service category="EAI.MSEJDF.Service" description="TODO: Remove. Temporary service for debug"
			name="Send e-mail (test)">

			<listeners>
				<jms-listener busidref="mailDispatchGwChannel"
					is-gateway="true" name="JMS-Gateway" />
				<jms-listener busidref="mailDispatchEsbChannel" name="ESB-Listener" />
			</listeners>

			<actions mep="OneWay">

				<action name="entryPrint" class="org.jboss.soa.esb.actions.SystemPrintln">
					<property name="message" value="Send e-mail Service..."></property>
				</action>


				<action name="exitPrint" class="org.jboss.soa.esb.actions.SystemPrintln">
					<property name="message" value="Send e-mail Service...Complete"></property>
				</action>

			</actions>
		</service>

		<!-- TODO: Remove. This is temporary for debug -->
		<service category="EAI.MSEJDF.Service" description="TODO: Remove. Temporary service for debug"
			name="Count e-mail">

			<listeners>
				<jms-listener busidref="mailCountGwChannel" is-gateway="true"
					name="JMS-Gateway" />
				<jms-listener busidref="mailCountEsbChannel" name="ESB-Listener" />
			</listeners>

			<actions mep="OneWay">

				<action name="entryPrint" class="org.jboss.soa.esb.actions.SystemPrintln">
					<property name="message" value="Count e-mail Service..."></property>
				</action>


				<action name="exitPrint" class="org.jboss.soa.esb.actions.SystemPrintln">
					<property name="message" value="Count e-mail Service...Complete"></property>
				</action>

			</actions>
		</service>


		<!-- TODO: Remove. This is temporary for debug -->
		<service category="TestCategory" description="TODO: Remove. Temporary service for debug"
			name="TestService">

			<listeners>
				<jms-listener busidref="testGwChannel" is-gateway="true"
					name="JMS-Gateway" />
				<jms-listener busidref="testEsbChannel" name="ESB-Listener" />
			</listeners>

			<actions mep="OneWay">

				<action name="entryPrint" class="org.jboss.soa.esb.actions.SystemPrintln">
					<property name="message" value="Test Service..."></property>
				</action>

				<action name="delay" class="eai.msejdf.esb.MyDelay">
				</action>

				<action name="exitPrint" class="org.jboss.soa.esb.actions.SystemPrintln">
					<property name="message" value="Test Service...Complete"></property>
				</action>

			</actions>
		</service>
		
		<!-- TODO: Remove. This is temporary for debug -->
		<service category="TestCategory" description="TODO: Remove. Temporary service for debug"
			name="TestService2">

			<listeners>
				<jms-listener busidref="testGwChannel" is-gateway="true"
					name="JMS-Gateway" />
				<jms-listener busidref="testEsbChannel" name="ESB-Listener" />
			</listeners>

			<actions mep="OneWay">

				<action name="entryPrint" class="org.jboss.soa.esb.actions.SystemPrintln">
					<property name="message" value="Test Service2..."></property>
				</action>

				<action name="delay" class="eai.msejdf.esb.MyDelay2">
				</action>

				<action name="exitPrint" class="org.jboss.soa.esb.actions.SystemPrintln">
					<property name="message" value="Test Service2...Complete"></property>
				</action>

			</actions>
		</service>		
	</services>
</jbossesb>